{"version":3,"sources":["../src/connect.js"],"names":["connect","fastify","config","next","user","password","name","hosts","options","connection","ConnectionFactory","create","Error","host","port","add","Host","key","value","Object","entries","set","console","log","toArray","then","conn","decorate","catch","err"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;AAEA,MAAMA,OAAO,GAAG,CAACC,OAAD,EAAUC,MAAV,EAAkBC,IAAlB,KAA2B;AAAA;AAEvC;AACA,QAAM;AACFC,IAAAA,IADE;AAEFC,IAAAA,QAFE;AAGFC,IAAAA,IAHE;AAIFC,IAAAA,KAJE;AAKFC,IAAAA;AALE,6BAMFN,MANE,CAAN,CAHuC,CAWvC;;AACA,QAAMO,UAAU,0BAAGC,8BAAkBC,MAAlB,EAAH,CAAhB,CAZuC,CAcvC;;AAduC;AAevCF,EAAAA,UAAU,CAACL,IAAX,GAAkBA,IAAlB,CAfuC,CAiBvC;;AAjBuC;AAkBvCK,EAAAA,UAAU,CAACJ,QAAX,GAAsBA,QAAtB,CAlBuC,CAoBvC;;AApBuC;;AAqBvC,MAAI,CAACC,IAAL,EAAW;AAAA;AAAA;AACPH,IAAAA,IAAI,CAAC,IAAIS,KAAJ,CAAU,+BAAV,CAAD,CAAJ;AADO;AAEP;AACH,GAHD;AAAA;AAAA;;AArBuC;AAyBvCH,EAAAA,UAAU,CAACH,IAAX,GAAkBA,IAAlB,CAzBuC,CA2BvC;;AA3BuC;;AA4BvC,MAAI,CAACC,KAAL,EAAY;AAAA;AAAA;AACRJ,IAAAA,IAAI,CAAC,IAAIS,KAAJ,CAAU,2CAAV,CAAD,CAAJ;AADQ;AAER;AACH,GAHD;AAAA;AAAA;;AA5BuC;;AAgCvC,OAAK,MAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAX,IAA4B,sBAAQP,KAAR,CAA5B,EAA4C;AAAA;AACxCE,IAAAA,UAAU,CAACF,KAAX,CAAiBQ,GAAjB,CAAqB,IAAIC,UAAJ,CAASH,IAAT,EAAeC,IAAf,CAArB;AACH,GAlCsC,CAoCvC;;;AApCuC;;AAqCvC,OAAK,MAAM,CAACG,GAAD,EAAMC,KAAN,CAAX,IAA2BC,MAAM,CAACC,OAAP,CAAeZ,OAAf,CAA3B,EAAoD;AAAA;AAChDC,IAAAA,UAAU,CAACD,OAAX,CAAmBa,GAAnB,CAAuBJ,GAAvB,EAA4BC,KAA5B;AACH;;AAvCsC;AAyCvCI,EAAAA,OAAO,CAACC,GAAR,CAAYd,UAAU,CAACD,OAAX,CAAmBgB,OAAnB,EAAZ,EAzCuC,CA2CvC;;AA3CuC;AA4CvCf,EAAAA,UAAU,CACLT,OADL,GAEKyB,IAFL,CAEWC,IAAD,IAAU;AAAA;AAAA;AACZzB,IAAAA,OAAO,CAAC0B,QAAR,CAAiB,IAAjB,EAAuBD,IAAvB;AADY;AAEZvB,IAAAA,IAAI;AACP,GALL,EAMKyB,KANL,CAMWC,GAAG,IAAI;AAAA;AAAA;AAAA,WAAA1B,IAAI,CAAC0B,GAAD,CAAJ;AAAS,GAN3B;AAOH,CAnDD;;eAqDe7B,O","sourcesContent":["import { ConnectionFactory } from './connection';\nimport { Host } from './host';\nimport { toArray } from './helpers';\n\nconst connect = (fastify, config, next) => {\n\n    // extract configs\n    const {\n        user,\n        password,\n        name,\n        hosts,\n        options\n    } = config;\n\n    // create the connection instance\n    const connection = ConnectionFactory.create();\n\n    // set the credentials of the connection\n    connection.user = user;\n\n    // set user for the connection\n    connection.password = password;\n\n    // set db name for the connection\n    if (!name) {\n        next(new Error('should provide database name.'));\n        return;\n    }\n    connection.name = name;\n\n    // add all the hostss\n    if (!hosts) {\n        next(new Error('should provide at lease one host details.'));\n        return;\n    }\n    for (const { host, port} of toArray(hosts)) {\n        connection.hosts.add(new Host(host, port));\n    }\n\n    // set all options\n    for (const [key, value] of Object.entries(options)) {\n        connection.options.set(key, value);\n    }\n\n    console.log(connection.options.toArray());\n\n    // establish the connection\n    connection\n        .connect()\n        .then((conn) => {\n            fastify.decorate('db', conn);\n            next();\n        })\n        .catch(err => next(err))\n}\n\nexport default connect;\n"],"file":"connect.js"}