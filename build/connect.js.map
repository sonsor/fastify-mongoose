{"version":3,"sources":["../src/connect.js"],"names":["connect","fastify","config","next","user","password","name","hosts","options","connection","ConnectionFactory","create","Error","host","port","add","Host","key","value","Object","entries","set","then","conn","decorate","catch","err"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;AAEA,MAAMA,OAAO,GAAG,CAACC,OAAD,EAAUC,MAAV,EAAkBC,IAAlB,KAA2B;AAAA;AAEvC;AACA,QAAM;AACFC,IAAAA,IADE;AAEFC,IAAAA,QAFE;AAGFC,IAAAA,IAHE;AAIFC,IAAAA,KAJE;AAKFC,IAAAA;AALE,6BAMFN,MANE,CAAN,CAHuC,CAWvC;;AACA,QAAMO,UAAU,0BAAGC,8BAAkBC,MAAlB,EAAH,CAAhB,CAZuC,CAcvC;;AAduC;AAevCF,EAAAA,UAAU,CAACL,IAAX,GAAkBA,IAAlB,CAfuC,CAiBvC;;AAjBuC;AAkBvCK,EAAAA,UAAU,CAACJ,QAAX,GAAsBA,QAAtB,CAlBuC,CAoBvC;;AApBuC;;AAqBvC,MAAI,CAACC,IAAL,EAAW;AAAA;AAAA;AACPH,IAAAA,IAAI,CAAC,IAAIS,KAAJ,CAAU,+BAAV,CAAD,CAAJ;AADO;AAEP,WAAO,KAAP;AACH,GAHD;AAAA;AAAA;;AArBuC;AA0BvCH,EAAAA,UAAU,CAACH,IAAX,GAAkBA,IAAlB,CA1BuC,CA4BvC;;AA5BuC;;AA6BvC,MAAI,CAACC,KAAL,EAAY;AAAA;AAAA;AACRJ,IAAAA,IAAI,CAAC,IAAIS,KAAJ,CAAU,2CAAV,CAAD,CAAJ;AADQ;AAER,WAAO,KAAP;AACH,GAHD;AAAA;AAAA;;AA7BuC;;AAkCvC,OAAK,MAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,GAAX,IAA4B,sBAAQP,KAAR,CAA5B,EAA4C;AAAA;AACxCE,IAAAA,UAAU,CAACF,KAAX,CAAiBQ,GAAjB,CAAqB,IAAIC,UAAJ,CAASH,IAAT,EAAeC,IAAf,CAArB;AACH,GApCsC,CAsCvC;;;AAtCuC;;AAuCvC,OAAK,MAAM,CAACG,GAAD,EAAMC,KAAN,CAAX,IAA2BC,MAAM,CAACC,OAAP,CAAeZ,OAAf,CAA3B,EAAoD;AAAA;AAChDC,IAAAA,UAAU,CAACD,OAAX,CAAmBa,GAAnB,CAAuBJ,GAAvB,EAA4BC,KAA5B;AACH,GAzCsC,CA2CvC;;;AA3CuC;AA4CvCT,EAAAA,UAAU,CACLT,OADL,GAEKsB,IAFL,CAEWC,IAAD,IAAU;AAAA;AAAA;AACZtB,IAAAA,OAAO,CAACuB,QAAR,CAAiB,IAAjB,EAAuBD,IAAvB;AADY;AAEZpB,IAAAA,IAAI,CAAC,IAAD,EAAOoB,IAAP,CAAJ;AACH,GALL,EAMKE,KANL,CAMWC,GAAG,IAAI;AAAA;AAAA;AAAA,WAAAvB,IAAI,CAACuB,GAAD,CAAJ;AAAS,GAN3B;AAOH,CAnDD;;eAqDe1B,O","sourcesContent":["import { ConnectionFactory } from './connection';\nimport { Host } from './host';\nimport { toArray } from './helpers';\n\nconst connect = (fastify, config, next) => {\n\n    // extract configs\n    const {\n        user,\n        password,\n        name,\n        hosts,\n        options\n    } = config;\n\n    // create the connection instance\n    const connection = ConnectionFactory.create();\n\n    // set the credentials of the connection\n    connection.user = user;\n\n    // set user for the connection\n    connection.password = password;\n\n    // set db name for the connection\n    if (!name) {\n        next(new Error('should provide database name.'));\n        return false;\n    }\n\n    connection.name = name;\n\n    // add all the hostss\n    if (!hosts) {\n        next(new Error('should provide at lease one host details.'));\n        return false;\n    }\n\n    for (const { host, port} of toArray(hosts)) {\n        connection.hosts.add(new Host(host, port));\n    }\n\n    // set all options\n    for (const [key, value] of Object.entries(options)) {\n        connection.options.set(key, value);\n    }\n\n    // establish the connection\n    connection\n        .connect()\n        .then((conn) => {\n            fastify.decorate('db', conn);\n            next(null, conn);\n        })\n        .catch(err => next(err))\n}\n\nexport default connect;\n"],"file":"connect.js"}